## Database (defaults to Postgres). You can override with environment variables:
## SPRING_DATASOURCE_URL, SPRING_DATASOURCE_USERNAME, SPRING_DATASOURCE_PASSWORD
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/QLTaiLieu}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:123456}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
# For development you can still use H2 by setting SPRING_DATASOURCE_URL accordingly.

## Disable automatic schema updates to avoid unsafe ALTERs on existing production DB columns
# For development you can set this to `update`, but when working with an existing schema that
# contains types that cannot be auto-cast by Postgres it's safer to disable automatic updates
# and apply migrations manually.
spring.jpa.hibernate.ddl-auto=none
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

# Enable H2 console only when using H2 (won't be used for Postgres)
spring.h2.console.enabled=false

# file upload dir (relative to project root)
file.upload-dir=storage/documents
file.avatar-dir=storage/avatars

# server port (Render provides PORT)
server.port=${PORT:8082}

# Dev helper (PowerShell): kiểm tra & tắt tiến trình chiếm cổng
# 1) netstat -ano | findstr :8082    -> lấy PID đang dùng cổng
# 2) Get-Process -Id <PID>           -> xem đó là tiến trình nào
# 3) taskkill /PID <PID> /F          -> tắt tiến trình (cần admin)

# Mail configuration for Gmail SMTP
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${SPRING_MAIL_USERNAME:thyanh758@gmail.com}

## Read SMTP password from environment to avoid committing credentials.
# Set SPRING_MAIL_PASSWORD in your shell / Render Environment.
spring.mail.password=${SPRING_MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.ssl.trust=*

# Add timeouts to avoid hanging
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000
spring.mail.properties.mail.debug=true
# Do not attempt to validate SMTP connection on startup. When SMTP credentials are not
# provided (dev mode), Spring's mail auto-validate can fail and stop the application.
spring.mail.test-connection=false

spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration

# Detailed logging for debugging startup issues
logging.level.org.springframework=DEBUG
logging.level.org.hibernate=DEBUG
logging.level.com.webquanly=DEBUG
logging.level.org.springframework.mail=DEBUG

# Show detailed error messages
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=always

## When true, the /api/auth/resend endpoint reveals whether an email is registered
## Set to false in production to avoid user enumeration attacks
app.auth.reveal-resend-result=false

spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=200MB